<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>webOS</title>

    <style>
      html,
      body {
        margin: 0;
        padding: 0;
        background: white;
        width: 100%;
        height: 100%;
        overflow: hidden;
      }

      canvas {
        display: block;
        margin: auto;
        padding: 10px;
        background: black;
      }
    </style>
  </head>
  <body>
    <canvas id="screen" width="1800" height="880"></canvas>
    <input
      id="kbd"
      type="text"
      autocapitalize="none"
      autocomplete="off"
      autocorrect="off"
      spellcheck="false"
      style="position: absolute; opacity: 0; left: -1000px; height: 0; width: 0"
    />

    <script>
      window.kernel = {
        wasm: null,
      };
    </script>
    <script src="./hal/hal.js"></script>
    <script>
      async function boot() {
        const response = await fetch("./build/shell.wasm");
        const bytes = await response.arrayBuffer();

        const imports = {
          env: {
            __hal_put_pixel,
            __hal_clear,
            __hal_present,
            __hal_get_width,
            __hal_get_height,
          },
        };

        const { instance } = await WebAssembly.instantiate(bytes, imports);
        window.kernel.wasm = instance;

        // Call user-space main()
        if (instance.exports.main) {
          instance.exports.main();
        } else {
          console.error("main() not found in WASM");
        }
      }

      boot();
    </script>
  </body>
</html>
